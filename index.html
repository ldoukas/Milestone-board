<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Renewal Board</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root {
            --stage-colors: #FFD700, #9ACD32, #20B2AA, #9370DB, #FF6347;
        }

        body {
            font-family: 'Arial Rounded MT Bold', sans-serif;
            background: #f0f0f0;
            margin: 0;
            padding: 20px;
            overflow-x: auto;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            min-width: 1200px;
            padding: 40px 0;
        }

        .stage {
            min-height: 80vh;
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            padding: 20px;
            position: relative;
        }

        .postit {
            width: 200px;
            min-height: 150px;
            padding: 20px;
            margin: 15px;
            position: absolute;
            cursor: grab;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            touch-action: none;
        }

        .postit[data-stage="1"] { background: #FFD700; }
        .postit[data-stage="2"] { background: #9ACD32; }
        .postit[data-stage="3"] { background: #20B2AA; }
        .postit[data-stage="4"] { background: #9370DB; }
        .postit[data-stage="5"] { background: #FF6347; }

        .stage-title {
            text-align: center;
            color: #666;
            font-size: 1.2em;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: white;
            padding: 10px;
            border-radius: 5px;
        }

        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .decision-note {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
            border-top: 1px dashed rgba(0,0,0,0.2);
            padding-top: 5px;
        }
    </style>
</head>
<body>
    <div class="controls">
        <input type="file" id="csvInput" accept=".csv">
        <button onclick="saveState()">Save State</button>
    </div>

    <div class="board">
        <div class="stage" data-stage="1">
            <div class="stage-title">üìÖ Pre-Renewal/Strategy</div>
        </div>
        <div class="stage" data-stage="2">
            <div class="stage-title">üìù Decisions</div>
        </div>
        <div class="stage" data-stage="3">
            <div class="stage-title">üöÄ Implementation</div>
        </div>
        <div class="stage" data-stage="4">
            <div class="stage-title">üìä Open Enrollment/Execution</div>
        </div>
        <div class="stage" data-stage="5">
            <div class="stage-title">üõ†Ô∏è Hyper Care</div>
        </div>
    </div>

    <script>
        let milestones = [];

        // Initialize from localStorage
        function loadState() {
            const saved = localStorage.getItem('boardState');
            if (saved) milestones = JSON.parse(saved);
            initBoard();
        }

        // CSV Import
        document.getElementById('csvInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            Papa.parse(file, {
                header: true,
                complete: function(results) {
                    milestones = results.data.map(item => ({
                        ...item,
                        stage: parseInt(item.stage),
                        left: parseFloat(item.left),
                        top: parseFloat(item.top)
                    }));
                    initBoard();
                }
            });
        });

        function createPostIt(milestone) {
            const postIt = document.createElement('div');
            postIt.className = 'postit';
            postIt.dataset.stage = milestone.stage;
            postIt.style.left = milestone.left + '%';
            postIt.style.top = milestone.top + '%';
            
            postIt.innerHTML = `
                <h3>${milestone.title}</h3>
                ${milestone.decision ? `<div class="decision-note">${milestone.decision}</div>` : ''}
                <small>Drag to move</small>
            `;

            makeDraggable(postIt, milestone);
            return postIt;
        }

        function makeDraggable(element, milestone) {
            let isDragging = false;
            
            element.addEventListener('mousedown', startDrag);
            element.addEventListener('touchstart', startDrag);

            function startDrag(e) {
                isDragging = true;
                document.addEventListener('mousemove', drag);
                document.addEventListener('touchmove', drag);
                document.addEventListener('mouseup', stopDrag);
                document.addEventListener('touchend', stopDrag);
            }

            function drag(e) {
                if (!isDragging) return;
                const rect = element.parentElement.getBoundingClientRect();
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                
                const x = ((clientX - rect.left) / rect.width) * 100;
                const y = ((clientY - rect.top) / rect.height) * 100;

                element.style.left = Math.max(0, Math.min(90, x)) + '%';
                element.style.top = Math.max(0, Math.min(90, y)) + '%';

                // Update position in data
                milestone.left = x;
                milestone.top = y;
            }

            function stopDrag() {
                isDragging = false;
                document.removeEventListener('mousemove', drag);
                document.removeEventListener('touchmove', drag);
            }
        }

        function initBoard() {
            const stages = document.querySelectorAll('.stage');
            stages.forEach(stage => stage.innerHTML = '<div class="stage-title">' + 
                stage.querySelector('.stage-title').innerHTML + '</div>');

            milestones.forEach(milestone => {
                const stage = document.querySelector(`.stage[data-stage="${milestone.stage}"]`);
                stage.appendChild(createPostIt(milestone));
            });
        }

        function saveState() {
            localStorage.setItem('boardState', JSON.stringify(milestones));
            alert('State saved!');
        }

        // Initial load
        loadState();
    </script>
</body>
</html>